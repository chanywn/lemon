<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>首页 - Razor</title>
    <link rel="icon" href="/favicon.ico">
	<link rel="stylesheet" href="/static/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/css/jumbotron-narrow.css">
	<link rel="stylesheet" href="/static/css/bootstrap-theme.min.css">
  </head>
  <body>
    <div class="container">
<div class="row">
<h1>什么是 Razor ?</h1>
<p>Razor 是一个快速，简单，可扩展的 PHP 框架。Razor 使您能够快速方便地构建REST web应用程序。</p>
<pre>
require 'vendor/import.php';

import::module('route');

route::get('/hello/(:any)', function($request, $response, $razor) {
  return $response->write("hello $razor");
});

route::run();
</pre>
<h2>路由</h2>
<p>在 Razor 中的路由是通过匹配的URL模式与回调函数。</p>
<pre><code class="language-php">route::get(&#039;/&#039;, function($request, $response) {
  echo &#039;index&#039;;
});</code></pre>
<p>当然也可以这样表示</p>
<pre><code class="language-php">route::get(&#039;/&#039;, &#039;hello&#039;);

function hello($request, $response){
    echo &#039;index&#039;;
}</code></pre>
<h3>请求方式</h3>
<p>route 是路由模块的静态类，您可以通过执行route类的各种静态方法来响应特定方法。</p>
<pre><code class="language-php">route::get(&#039;/get&#039;, function($request, $response) {
    echo &#039;我收到了一个 GET 请求&#039;;
});

route::post(&#039;/post&#039;, function($request, $response) {
    echo &#039;我收到了一个 POST 请求&#039;;
});</code></pre>
<p>使用下面的方法，可以响应任意请求不管是GET或者POST.</p>
<pre><code class="language-php">route::any(&#039;/any&#039;, function($request, $response) {
    echo sprintf(&#039;我收到了一个 %s 请求&#039;, $request-&gt;method);
});</code></pre>
<p>你可能已经注意到了回调函数中的 <code>$request</code> 和 <code>$response</code>，这两个参数，这两个参数是<code>request</code>和<code>response</code>类的实例，是回调函数的必须参数。这两个参数很有用，之后会介绍。</p>
<h3>通配符路由</h3>
<p>一个典型的使用通配符的路由规则如下:</p>
<pre><code class="language-php">route::get(&#039;/hello/(:any)&#039;, function($request, $response, $name) {
    echo &#039;hello &#039; . $name;
});
</code></pre>
<p>该方法第一个参数是要匹配的路由URL,其中<code>(:any)</code> 通配符用来匹配任意值。在回调函数中我们使用了<code>$name</code>参数来接收这个值。</p>
<p>上面典型的路由匹配的是一个，匹配多个值的时候，回调函数中的参数位置对应匹配的值，参数名自定。</p>
<pre><code class="language-php">route::get(&#039;/(:num)/(:num)/(:num)&#039;, function($request, $response, $year, $month, $day) {
    echo $year . &#039;/&#039; . $month . &#039;/&#039; . $day;
});</code></pre>
<p><code>(:num)</code> 匹配只含有数字的一段。 <code>(:any)</code> 匹配含有任意字符的一段,正则匹配暂不支持。</p>
<h2>Request（请求）</h2>
<p>得到当前请求的路径、方法、ip </p>
<pre><code class="language-php">route::get(&#039;/&#039;, function($request, $response) {
    echo $request-&gt;path .&#039;&lt;br&gt;&#039;;
    echo $request-&gt;method .&#039;&lt;br&gt;&#039;;
    echo $request-&gt;ip .&#039;&lt;br&gt;&#039;;
});</code></pre>
<p>接受get参数
localhost:3000/home?name=razor&age=0</p>
<pre><code class="language-php">route::get(&#039;/home&#039;, function($request, $response) {
    var_dump($request-&gt;get());
    // or
    echo $request-&gt;get(&#039;name&#039;);
});</code></pre>
<p>接受post参数</p>
<pre><code class="language-php">route::any(&#039;/home&#039;, function($request, $response) {
    var_dump($request-&gt;post());
    // or
    echo $request-&gt;post(&#039;name&#039;);
});</code></pre>
<p>判断当前请求类型</p>
<pre><code class="language-php">route::any(&#039;/&#039;, function($request, $response) {
    if($request-&gt;isGET()) {
        echo &#039;当前是 GET 请求&#039;;
    }

    if($request-&gt;isPost()) {
        echo &#039;当前是 Post 请求&#039;;   
    }
});</code></pre>
<h2>Response（响应）</h2>
<p>重定向</p>
<pre><code class="language-php">route::get(&#039;/&#039;, function($request, $response) {
    return $response-&gt;redirect(&#039;/home&#039;);
});</code></pre>
<p>返回HTTP状态码</p>
<pre><code class="language-php">route::get(&#039;/&#039;, function($request, $response) {
    return $response-&gt;statusCode(404);
});</code></pre>
<p>渲染视图</p>
<pre><code class="language-php">route::get(&#039;/&#039;, function($request, $response) {
    return $response-&gt;view(&#039;index&#039;);
});</code></pre>
<p>或者</p>
<pre><code class="language-php">route::get(&#039;/&#039;, function($request, $response) {
    return $response-&gt;view(&#039;index&#039;, [&#039;title&#039; =&gt; &#039;首页&#039;]);
});</code></pre>
<h2>数据库操作</h2>
<p>首先找到根目录下configs.php配置数据库连接信息，然后引入数据库操作对象<code>db</code>。</p>
<pre><code class="language-php">import::module(&#039;db&#039;);</code></pre>
<h3>原生语句</h3>
<h3>结构化查询</h3>
<p>你可以使用 <code>db</code> 的 <code>table</code> 方法开始查询。这个 <code>table</code> 方法针对查询表返回一个查询构造器实例，允许你在查询时链式调用更多约束，并使用 get 方法获取最终结果：</p>
<pre><code class="language-php">&lt;?php
require &#039;../vendor/import.php&#039;;

import::module(&#039;route&#039;);
import::module(&#039;log&#039;);
import::module(&#039;db&#039;);

route::get(&#039;/&#039;, function($request, $response) {
     $users = db::table(&#039;users&#039;)-&gt;get();
});

route::run();</code></pre>
<p>get 方法有一个参数，默认是<code>*</code>,执行成功返回一个数组。</p>
<h4>从数据表中获取单个列或行</h4>
<p>如果你只需要从数据表中获取一行数据，则可以使用 first 方法。这个方法将返回单个关联数组：</p>
<pre><code class="language-php">$user = db::table(&#039;users&#039;)-&gt;where(&#039;name&#039;, &#039;John&#039;)-&gt;first();

echo $user[&#039;name&#039;];</code></pre>
<p>如果你不需要一整行数据，则可以带上参数来从单条记录中取出单个值。此方法将直接返回字段的值：</p>
<pre><code class="language-php">$name= db::table(&#039;users&#039;)-&gt;where(&#039;name&#039;, &#039;John&#039;)-&gt;first(&lsquo;name&rsquo;);

echo $name;</code></pre>
<h4>find 子句</h4>
<p>如果你的某个表主键名正好叫<code>id</code>,你可以这样找到它。</p>
<pre><code class="language-php">db::table(&#039;users&#039;)-&gt;find($id);</code></pre>
<p>如果它叫其它什么名</p>
<pre><code class="language-php">db::table(&#039;users&#039;)-&gt;find($id, &#039;user_id&#039;);</code></pre>
<h4>orderBy 子句</h4>
<p>orderBy 方法允许你根据指定字段对查询结果进行排序。orderBy 方法的第一个参数是你想要用来排序的字段，而第二个参数则控制排序的顺序，可以为 asc 或 desc：</p>
<pre><code class="language-php"> db::table(&#039;users&#039;)-&gt;orderBy(&#039;id&#039;)-&gt;get();</code></pre>
<h4>Where 子句</h4>
<p>你可以在查询构造器实例中使用 where 方法从而把 where 子句加入到这个查询中。基本的 where 方法需要3个参数。第一个参数是字段的名称。第二个参数是要对字段进行评估的值。第三个参数是运算符，可选参数默认为<code>=</code>,它可以是数据库所支持的任何运算符。</p>
<pre><code class="language-php">$users = db::table(&#039;users&#039;)-&gt;where(&#039;votes&#039;, 100)-&gt;get();

$users = db::table(&#039;users&#039;)-&gt;where(&#039;votes&#039;, 100, &#039;&gt;&#039;)-&gt;get();</code></pre>
<h4>take 子句</h4>
<p>你可以使用take 方法来限制查询结果数量，两个参数第一个是起始位置，第二个是取多少条数据：</p>
<pre><code class="language-php">$users = db::table(&#039;users&#039;)-&gt;take(10, 20)-&gt;get();</code></pre>
<h3>insert 方法</h3>
<p>查询构造器也提供了 insert 方法，用来插入记录到数据表中。insert 方法接收一个包含字段名和值的数组作为参数：</p>
<pre><code class="language-php">db::table(&#039;users&#039;)-&gt;insert(
    [&#039;email&#039; =&gt; &#039;john@example.com&#039;, &#039;votes&#039; =&gt; 0]
);</code></pre>
<p>执行成功返回受影响的行，失败返回<code>false</code>.</p>
<h4>自增 ID</h4>
<p>（无）</p>
<h3>Updates 方法</h3>
<p>当然，除了在数据库中插入记录外，你也可以使用 update 来更新已存在的记录。update 方法和 insert 方法一样，接收含有字段及值的数组，其中包括要更新的字段。可以使用 where 子句来约束 update 查找：</p>
<pre><code class="language-php">db::table(&#039;users&#039;)-&gt;where(&#039;id&#039;, 1)-&gt;update([&#039;votes&#039; =&gt; 1]);</code></pre>
<h4>自增或自减</h4>
<p>（无）</p>
<h3>Delete 方法</h3>
<p>查询构造器也可使用 delete 方法从数据表中删除记录。在 delete 前，还可使用 where 子句来约束 delete 语法：</p>
<pre><code class="language-php">db::table(&#039;users&#039;)-&gt;delete();

db::table(&#039;users&#039;)-&gt;where(&#039;votes&#039;, &#039;&gt;&#039;, 100)-&gt;delete();</code></pre>
<p><a class="btn btn-lg btn-success" href="https://github.com/chanywn/razor" role="button">GitHub</a></p>
</div>

      <footer class="footer">
        <p>&copy; 2017 Company, Inc.</p>
      </footer>

    </div> <!-- /container -->
  </body>
</html>